<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Apple Store üçé</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:#fff}
header{position:sticky;top:0;padding:14px 20px;border-bottom:1px solid #eee;display:flex;justify-content:space-between}
header span{cursor:pointer}
section{display:none}
section.active{display:block}
.hero{text-align:center;padding:50px 20px}
.sale{color:#d60000;font-weight:600}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;padding:20px}
.card{background:#f5f5f7;border-radius:26px;padding:20px;text-align:center;cursor:pointer}
button{padding:12px 22px;border-radius:999px;border:none;background:#0071e3;color:#fff;cursor:pointer;margin-top:10px}
.options{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.option{padding:8px 16px;border-radius:999px;border:1px solid #ccc;cursor:pointer}
.option.active{background:#000;color:#fff}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center}
.modal{background:#fff;border-radius:24px;padding:20px;width:90%;max-width:420px}
.faceid{width:90px;height:90px;border:3px solid #000;border-radius:20px;margin:0 auto 15px;position:relative}
.scan{position:absolute;left:0;right:0;height:4px;background:#0071e3;animation:scan 1.2s infinite}
@keyframes scan{from{top:0}to{top:86px}}
.recent{padding:20px}
</style>
</head>

<body>

<header>
  <b onclick="show('catalog')">Apple Store</b>
  <span onclick="openCart()">–ö–æ—Ä–∑–∏–Ω–∞ (<span id="count">0</span>)</span>
</header>

<section id="catalog" class="active">
  <div class="hero">
    <h1>iPhone</h1>
    <p class="sale">üî• –°–ö–ò–î–ö–ò 20%</p>
    <button onclick="clearCart()" style="background:#d60000">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
  </div>

  <div class="grid">
    <div class="card" onclick="openProduct(1)"><h3>iPhone 15 Pro</h3><p>–æ—Ç 95 992 ‚ÇΩ</p></div>
    <div class="card" onclick="openProduct(2)"><h3>iPhone 15</h3><p>–æ—Ç 71 992 ‚ÇΩ</p></div>
  </div>

  <div class="recent">
    <h3>–ù–µ–¥–∞–≤–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏</h3>
    <div id="recent"></div>
  </div>
</section>

<section id="product">
  <div class="hero">
    <h1 id="pName"></h1>
    <img id="pImg" style="width:200px">
    <h2 id="pPrice"></h2>

    <h3>–¶–≤–µ—Ç</h3>
    <div id="colors" class="options"></div>

    <h3>–ü–∞–º—è—Ç—å</h3>
    <div id="memory" class="options"></div>

    <button onclick="add()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button><br>
    <button onclick="show('catalog')">‚Üê –ù–∞–∑–∞–¥</button>
  </div>
</section>

<div id="cart" class="overlay">
  <div class="modal">
    <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
    <div id="items"></div>
    <button onclick="startFaceID()">–û–ø–ª–∞—Ç–∏—Ç—å</button>
    <button onclick="closeCart()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<div id="face" class="overlay">
  <div class="modal" style="text-align:center">
    <div class="faceid"><div class="scan"></div></div>
    <b>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ Face ID</b>
  </div>
</div>

<audio id="sound" src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.wav"></audio>

<script>
const DISCOUNT=0.8;

const products={
  1:{name:'iPhone 15 Pro',base:Math.round(119990*DISCOUNT),colors:['–ß—ë—Ä–Ω—ã–π','–ë–µ–ª—ã–π'],memory:['128 –ì–ë','256 –ì–ë'],memoryPrice:{'128 –ì–ë':0,'256 –ì–ë':8000},image:'https://store.storeimages.cdn-apple.com/is/iphone-15-pro-black'},
  2:{name:'iPhone 15',base:Math.round(89990*DISCOUNT),colors:['–ß—ë—Ä–Ω—ã–π','–°–∏–Ω–∏–π'],memory:['128 –ì–ë'],memoryPrice:{'128 –ì–ë':0},image:'https://store.storeimages.cdn-apple.com/is/iphone-15-black'}
};

let cart=JSON.parse(localStorage.getItem('cart')||'[]');
let recent=JSON.parse(localStorage.getItem('recent')||'[]');
let current,selColor,selMemory;

function show(id){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function openProduct(id){
  current=id;
  const p=products[id];
  selColor=p.colors[0];
  selMemory=p.memory[0];
  pName.innerText=p.name;
  pImg.src=p.image;
  renderOptions('colors',p.colors,v=>selColor=v);
  renderOptions('memory',p.memory,v=>{selMemory=v;updatePrice()});
  updatePrice();
  show('product');
}

function renderOptions(el,arr,cb){
  const box=document.getElementById(el);
  box.innerHTML='';
  arr.forEach((v,i)=>{
    const d=document.createElement('div');
    d.className='option'+(i===0?' active':'');
    d.innerText=v;
    d.onclick=()=>{
      box.querySelectorAll('.option').forEach(o=>o.classList.remove('active'));
      d.classList.add('active');cb(v);
    };
    box.appendChild(d);
  });
}

function updatePrice(){
  const p=products[current];
  pPrice.innerText=(p.base+p.memoryPrice[selMemory]).toLocaleString('ru-RU')+' ‚ÇΩ';
}

function add(){
  const p=products[current];
  cart.push({name:p.name,color:selColor,memory:selMemory,price:p.base+p.memoryPrice[selMemory]});
  save();
  alert('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É üçé');
}

function openCart(){
  items.innerHTML=cart.length?cart.map(i=>`<div>${i.name} ‚Äî ${i.price.toLocaleString('ru-RU')} ‚ÇΩ</div>`).join(''):'–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞';
  cartBox.style.display='flex';
}

function closeCart(){cartBox.style.display='none'}

function clearCart(){cart=[];save()}

function save(){
  localStorage.setItem('cart',JSON.stringify(cart));
  count.innerText=cart.length;
}

function startFaceID(){
  sound.play();
  face.style.display='flex';
  setTimeout(checkout,2000);
}

function checkout(){
  face.style.display='none';
  const total=cart.reduce((s,i)=>s+i.price,0);
  recent.unshift({date:new Date().toLocaleString(),total});
  recent=recent.slice(0,5);
  localStorage.setItem('recent',JSON.stringify(recent));
  cart=[];
  save();
  renderRecent();
  alert('–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ ‚úÖ');
}

function renderRecent(){
  recentEl.innerHTML=recent.map(r=>`${r.date} ‚Äî ${r.total.toLocaleString('ru-RU')} ‚ÇΩ`).join('<br>');
}

const cartBox=document.getElementById('cart');
const face=document.getElementById('face');
const recentEl=document.getElementById('recent');
const sound=document.getElementById('sound');

save();
renderRecent();
</script>

</body>
</html>
